$(document).ready(function () {
	
	var verifyCode = xhq.getQuery("verifyCode")||"";
	if(verifyCode=='' || verifyCode ==null){
		$.toast('核销码不能为空！');
		return;
	}
	
	$.showIndicator();
	var param={interId:'toc.verifyCodeOrderDetail',orgId:4,verifyCode:verifyCode};
	xhq.__runXHQ(param, function(data){
		$.hideIndicator();
		if (data.status == 0){
			
			if(data.body.verifyStatus=='1'){
				$(".tab-label").text("确定核销");
			}else{
				$(".tab-label").text("确定");
			}
			$(".content").html(verifyHtml(data.body));
		}else{
			$(".bar-tab").css('display','none')
			$.alert(data.message);
			xhq.gotoUrl('../html/verification.html')
		}
	});
	
})

	// 确定核销
	$(".tab-label").on('tap',function(){
		// 校验手机号和验证码是否已输入
		var orgId =  xhq.getQuery("orgId")||"";//供应商id
		var verifyCode = $('#verifyCode').val();
		if (verifyCode == null || verifyCode == ""){
			$.toast("消费码未录入");
			return;	
		}
		if (verifyCode.length != 8){
			$.toast("消费码长度不正确，请检查");
			return;	
		}
		
		if($(".tab-label").text()=="确定核销"){
			$.showIndicator();
			var param={interId:'toc.verifyOrderDetail',verifyCode:verifyCode};
			xhq.__runXHQ(param, function(data){
				$.hideIndicator();
				if (data.status == 0){
					$.alert("核销成功");
					xhq.gotoUrl('../html/verification.html')
				}else{
					$.toast(data.message);
				}
			});
		}
		
		xhq.gotoUrl('../html/verification.html')
	})
	
function verifyHtml(data){
	
	var html = '<div class="big_box end" >'
	 html += '<div class="mid_box">'
	 html += '<div class="mid_l"><img src="'+data.bigPic+'" alt=""></div>'
	 html += '<div class="mid_c">'
	 html += '<div class="text_name">'+data.showName+'</div>'
	 html += '<div class="text_box">'
	 html += '<div class="text_pri">&yen;<span>'+data.salePrice/100+'</span></div>'
	 html += '<div class="text_num">x<span>'+data.num+'</span></div>'
	 html += '</div>'
	 html += '</div>'
	 html += '</div>'

	 html += '<div class="up_box">'
	 html += '<div class="up_l">商家信息：</div>'
	 html += '<div class="up_name">'+data.name+'</div>'
	 html += '</div>'
	 html += '<div class="code_infor">消费券码：<span>'+data.verifyCode+'</span></div>'
	 html += '<div class="con_box">'
	 if(data.verifyStatus=='1'){
		 html += '<div class="text_data">有效期至：<span>'+data.yxqzTime+'</span></div>'
		 html += '<div class="up_state">未消费</div>'
	 }else{
		 html += '<div class="text_data">核销时间：<span>'+data.verifiyTime+'</span></div>'
		 html += '<div class="up_state">已消费</div>'
	 }
	
	 html += '</div>'
	 html += '</div>'
	return html;
}
